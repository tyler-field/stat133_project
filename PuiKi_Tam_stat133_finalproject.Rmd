---
title: "STAT133 Final Project"
author: "Pui Ki Tam 3032325323"
date: "4/28/2017"
output: html_document
---

<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
library(dplyr)
library(ggplot2)
library(plyr)
library(ggthemes)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```
<!-- Don't edit the material above this line -->
```{r}
#	Name	Description
#1	Year	1987-2008
#2	Month	1-12
#3	DayofMonth	1-31
#4	DayOfWeek	1 (Monday) - 7 (Sunday)
#5	DepTime	actual departure time (local, hhmm)
#6	CRSDepTime	scheduled departure time (local, hhmm)
#7	ArrTime	actual arrival time (local, hhmm)
#8	CRSArrTime	scheduled arrival time (local, hhmm)
#9	UniqueCarrier	unique carrier code
#10	FlightNum	flight number
#11	TailNum	plane tail number
#12	ActualElapsedTime	in minutes
#13	CRSElapsedTime	in minutes
#14	AirTime	in minutes
#15	ArrDelay	arrival delay, in minutes
#16	DepDelay	departure delay, in minutes
#17	Origin	origin IATA airport code
#18	Dest	destination IATA airport code
#19	Distance	in miles
#20	TaxiIn	taxi in time, in minutes
#21	TaxiOut	taxi out time in minutes
#22	Cancelled	was the flight cancelled?
#23	CancellationCode	reason for cancellation (A = carrier, B = weather, C = NAS, D = security)
#24	Diverted	1 = yes, 0 = no
#25	CarrierDelay	in minutes
#26	WeatherDelay	in minutes
#27	NASDelay	in minutes
#28	SecurityDelay	in minutes
#29	LateAircraftDelay	in minutes
```

```{r}
setwd("/Users/pktam/Desktop")
getwd()
df <- read.csv("AirplaneData.csv")
names(df)
```

```{r}
table1arrive <- select(df, FL_DATE, ORIGIN, ORIGIN_AIRPORT_ID, ARR_DELAY, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY)

table2arrive <- table1arrive %>% filter(ARR_DELAY>0)

table3arrive <- table2arrive %>% mutate(Total_Delay= CARRIER_DELAY + WEATHER_DELAY + NAS_DELAY + SECURITY_DELAY + LATE_AIRCRAFT_DELAY)

table4arrive <- table3arrive %>% filter(ARR_DELAY== Total_Delay)


countArriveCarrierD <- length(which(table4arrive$CARRIER_DELAY > 0))
countArriveWeatherD <- length(which(table4arrive$WEATHER_DELAY > 0))
countArriveNasD <- length(which(table4arrive$NAS_DELAY > 0))
countArriveSecurityD <- length(which(table4arrive$SECURITY_DELAY > 0))
countArriveAircraftD <- length(which(table4arrive$LATE_AIRCRAFT_DELAY > 0))


bar_numbers <- c(countArriveCarrierD, countArriveWeatherD, countArriveNasD, countArriveSecurityD, countArriveAircraftD)
bar_causes <- c("Carrier", "Weather", "Nas", "Security", "Late Aircraft")
ArriveBarData <- data.frame(Arrive.Delay.Causes= bar_causes, Number= bar_numbers)

ArriveBarData = ArriveBarData[with(ArriveBarData, order(-bar_numbers)), ]

ArriveBarData

png(file= "ArriveDelayBarplot.jpg")

ArriveDelayBarplot<- ggplot(data=ArriveBarData, aes(x=reorder(ArriveBarData$Arrive.Delay.Causes, -ArriveBarData$Number), y= Number, fill=Arrive.Delay.Causes)) +
  geom_bar(stat = "identity", width=0.85) +
  geom_text(aes(label= Number), vjust=-0.3, color="violetred4", size=3.5) +
  labs(title = "Arrival Delay Causes in January 2017", x = "Delay Causes", y = "Delay Numbers") +
  theme(plot.title = element_text(size = 16, color = "gray4"),  
       axis.title.x = element_text(size = 10, color = "slateblue3"),  
        axis.title.y = element_text(size = 10, color = "violetred4")) 
ArriveDelayBarplot 

dev.off()

```


```{r}

table1arrive <- select(df, FL_DATE, ORIGIN, ORIGIN_AIRPORT_ID, ARR_DELAY, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY)

table2arrive <- table1arrive %>% filter(ARR_DELAY>0)

table3arrive <- table2arrive %>% mutate(Total_Delay= CARRIER_DELAY + WEATHER_DELAY + NAS_DELAY + SECURITY_DELAY + LATE_AIRCRAFT_DELAY)

table4arrive <- table3arrive %>% filter(ARR_DELAY== Total_Delay)

table5arrive <- table4arrive %>% mutate(CarrierDelayPercent= 100*CARRIER_DELAY/ARR_DELAY)
table5arrive <- table5arrive %>% mutate(WeatherDelayPercent= 100*WEATHER_DELAY/ARR_DELAY)
table5arrive <- table5arrive %>% mutate(NasDelayPercent= 100*NAS_DELAY/ARR_DELAY) 
table5arrive <- table5arrive %>% mutate(SecurityDelayPercent= 100*SECURITY_DELAY/ARR_DELAY)
table5arrive <- table5arrive %>% mutate(LateAircraftDelayPercent= 100*LATE_AIRCRAFT_DELAY/ARR_DELAY)

table5arrive

arriveCarrierDelay <- mean(table5arrive$CarrierDelayPercent)
arriveWeatherDelay <- mean(table5arrive$WeatherDelayPercent)
arriveNasDelay <- mean(table5arrive$NasDelayPercent)
arriveSecurityDelay <- mean(table5arrive$SecurityDelayPercent)
arriveLateAircraftDelay <- mean(table5arrive$LateAircraftDelayPercent)

pie_numberarrive <- c(arriveCarrierDelay, arriveWeatherDelay, arriveNasDelay, arriveSecurityDelay, arriveLateAircraftDelay)
pie_numberarrive
labels <- c("Carrier Delay", "Weather Delay", "NAS Delay", "Security Delay", "Late Aircraft Delay")

pie_numberarrive <- round(pie_numberarrive, 1)
pie_numberarrive

labels2arrive <- paste(labels, pie_numberarrive)
labels2arrive <- paste(labels2arrive, "%", sep="")

colors <- c("yellow", "cyan", "green", "red", "orange")

png(file= "ArrDelayPie.jpg")

pie(pie_numberarrive, labels= labels2arrive, main = "Arrival Delay Causes in January 2017", col = colors)

dev.off()
```


```{r}
table1 <- select(df, FL_DATE, ORIGIN, DEP_DELAY, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY)

table2 <- table1 %>% filter(DEP_DELAY>0)

table3 <- table2 %>% mutate(Total_Delay= CARRIER_DELAY + WEATHER_DELAY + NAS_DELAY + SECURITY_DELAY + LATE_AIRCRAFT_DELAY)

table4 <- table3 %>% filter(DEP_DELAY>= Total_Delay)


#Counting the flight freq of each airports
FlightsFeq <- count(table1, 'ORIGIN') 

#Sorting the freq of data from high to low 
FlightsFeq <- FlightsFeq[with(FlightsFeq, order(-freq)), ]
FlightsFeq

#Choosing the top 50 busiet airports
Busy25 <- top_n(FlightsFeq, 25, freq)
#Renaming the column 
colnames(Busy25)[colnames(Busy25) == 'freq'] <- 'TotalFlightFreq'

DelayAirports <- left_join(table2, Busy25, by="ORIGIN")
DelayAirports25 <- DelayAirports %>% filter(TotalFlightFreq>= 0)
#this would be the detailed table of all delayed flights from the top 50 busiest airports
DelayAirports25

Delay25 <- count(DelayAirports25, 'ORIGIN')
colnames(Delay25)[colnames(Delay25) == 'freq'] <- 'TotalDelayFreq'
#Producing a table with the counts of delays of the top 50 busiest airports
Delay25

Busy25 <- left_join(Busy25, Delay25, by="ORIGIN")
#generate a delay percentage
Busy25 <- mutate(Busy25, DelayPercentage= 100*TotalDelayFreq/TotalFlightFreq)
Busy25

AirportState <- select(df, ORIGIN, ORIGIN_STATE_NM)
AirportState <- AirportState %>% distinct(ORIGIN, .keep_all = TRUE)
AirportState

Busy25 <- left_join(Busy25, AirportState, by="ORIGIN")
Busy25

#Catagorizing states into regions
Northeast <- c("Connecticut", "Maine", "Massachusetts", "New Hampshire", "Rhode Island", "Vermont", "Delaware", "New Jersey", "New York", "Pennsylvania")
Midwest <- c("Illinois", "Indiana", "Michigan", "Ohio", "Wisconsin", "Iowa", "Kansas", "Minnesota", "Missouri", "Nebraska", "North Dakota", "South Dakota")
South <- c("South Atlantic", "Florida", "Georgia", "Maryland", "North Carolina", "South Carolina", "Virginia", "District of Columbia", "West Virginia", "Texas", "Tennessee", "Louisiana", "Kentucky")
West <- c("Arizona", "Colorado", "Idaho", "Montana", "Nevada", "New Mexico", "Utah", "Wyoming", "Alaska", "California", "Hawaii", "Oregon", "Washington")

#adding a region column to busy50
Busy25Region <- mutate(Busy25, Region = ifelse(Busy25$ORIGIN_STATE_NM %in% Northeast, "Northeast", ifelse(Busy25$ORIGIN_STATE_NM %in% Midwest, "Midwest", ifelse(Busy25$ORIGIN_STATE_NM %in% South, "South", ifelse(Busy25$ORIGIN_STATE_NM %in% West, "West", "Other")))))
Busy25Region

png(file= "Busy25Delay.jpg")

#ggplot(Busy50Region, aes(x = ORIGIN, y = DelayPercentage)) +
  #geom_point() +
  #facet_grid(. ~ Region) +
  #theme(axis.text.x = element_text(angle = 65, vjust = 0.5, hjust=1, size = 3)) +
  #ggtitle("Delay Percentage of the Top 50 Busiet US Airports in January 2017")

ggplot(Busy25Region, aes(x = DelayPercentage, y = ORIGIN)) +
  geom_point() +
  facet_grid(Region ~ .) +
  theme(axis.text.y = element_text(size = 5)) +
  ggtitle("Delay Percentage of the Top 25 Busiet US Airports in January 2017")

dev.off()

```








